# Choreo Component Configuration for Cinema Management System
schemaVersion: 1.2

# Incoming connection details for the component
endpoints:
  # Backend REST API Endpoint
  - name: cinema-backend-api
    displayName: Cinema Management Backend API
    service:
      basePath: /
      port: 8081
    type: REST
    networkVisibilities:
      - Public
      - Organization
    schemaFilePath: openapi.yaml

# Outgoing connection details for the component
dependencies:
  # MongoDB Atlas connection
  serviceReferences:
    - name: mongodb-connection
      connectionConfig:
        - name: MONGODB_URI
          description: MongoDB Atlas connection string

# Runtime configurations
configurations:
  # Environment variables from connections
  env:
    # MongoDB Configuration
    - name: MONGODB_URI
      valueFrom:
        secretRef:
          name: mongodb-uri
    - name: MONGODB_DATABASE
      valueFrom:
        configForm:
          displayName: MongoDB Database Name
          required: true
          type: string
          default: cinema_db

    # Server Configuration
    - name: SERVER_PORT
      valueFrom:
        configForm:
          displayName: Server Port
          required: false
          type: string
          default: "8081"

    # JWT Configuration
    - name: JWT_SECRET
      valueFrom:
        secretRef:
          name: jwt-secret
    - name: JWT_EXPIRATION
      valueFrom:
        configForm:
          displayName: JWT Token Expiration (ms)
          required: false
          type: string
          default: "86400000"

    # CORS Configuration
    - name: CORS_ALLOWED_ORIGINS
      valueFrom:
        configForm:
          displayName: CORS Allowed Origins (comma-separated)
          required: true
          type: string
          default: https://cinema-management-system-tan.vercel.app,http://localhost:3000

    # Mail Configuration
    - name: MAIL_HOST
      valueFrom:
        configForm:
          displayName: Mail Server Host
          required: false
          type: string
          default: smtp.gmail.com
    - name: MAIL_PORT
      valueFrom:
        configForm:
          displayName: Mail Server Port
          required: false
          type: string
          default: "587"
    - name: MAIL_USERNAME
      valueFrom:
        secretRef:
          name: mail-username
    - name: MAIL_PASSWORD
      valueFrom:
        secretRef:
          name: mail-password

    # Stripe Payment Configuration
    - name: STRIPE_API_KEY
      valueFrom:
        secretRef:
          name: stripe-api-key
    - name: STRIPE_PUBLIC_KEY
      valueFrom:
        secretRef:
          name: stripe-public-key
    - name: STRIPE_WEBHOOK_SECRET
      valueFrom:
        secretRef:
          name: stripe-webhook-secret

    # Application Configuration
    - name: ADMIN_EMAIL
      valueFrom:
        configForm:
          displayName: Default Admin Email
          required: false
          type: string
          default: admin@cinema.com
    - name: ADMIN_PASSWORD
      valueFrom:
        secretRef:
          name: admin-password
    - name: USER_WELCOME_BONUS
      valueFrom:
        configForm:
          displayName: User Welcome Bonus Points
          required: false
          type: string
          default: "100"
    - name: SEATS_ROWS
      valueFrom:
        configForm:
          displayName: Seat Rows (comma-separated)
          required: false
          type: string
          default: A,B,C,D,E,F,G,H,I,J
    - name: SEATS_PER_ROW
      valueFrom:
        configForm:
          displayName: Seats Per Row
          required: false
          type: string
          default: "10"

# Build configuration
build:
  # Docker build context
  dockerfile: cinema-manager/backend/Dockerfile
  context: cinema-manager/backend
